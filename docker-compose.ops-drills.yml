services:
  billing-worker-service:
    environment:
      # Enable DLQ replay endpoint
      WORKER_JOBS_DLQ_REPLAYER_ENABLED: "true"

      # Make DLQ drills complete quickly by skipping long retry queues.
      # With maxAttempts=1, the first retryable failure moves directly to DLQ.
      WORKER_JOBS_FINALIZE_EMPLOYEE_MAX_ATTEMPTS: "1"

      # Protect worker internal operational endpoints under /internal/**.
      # This is separate from edge-service auth.
      # Note: Map properties require SPRING_APPLICATION_JSON for env var binding
      SPRING_APPLICATION_JSON: |
        {
          "worker": {
            "internal-auth": {
              "jwt-keys": {"k1": "${WORKER_INTERNAL_AUTH_JWT_KEYS_K1:-dev-worker-internal-token}"},
              "jwt-default-kid": "k1",
              "jwt-issuer": "us-payroll-platform",
              "jwt-audience": "billing-worker-service"
            }
          }
        }

  billing-orchestrator-service:
    environment:
      # Orchestrator internal auth verifier key (used by worker -> orchestrator internal calls).
      # Keep this stable for drills; the worker's signing key can be changed to simulate auth failures.
      # Note: Map properties require SPRING_APPLICATION_JSON for env var binding
      SPRING_APPLICATION_JSON: |
        {
          "orchestrator": {
            "internal-auth": {
              "jwt-keys": {"k1": "${ORCHESTRATOR_INTERNAL_AUTH_JWT_KEYS_K1:-dev-internal-token}"},
              "jwt-default-kid": "k1"
            }
          }
        }
